<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A7med_Ashraf Admin Panel</title>
<style>
  body {
    font-family: "Tahoma", sans-serif;
    direction: rtl;
    margin: 0;
    padding: 0;
    display: flex;
    height: 100vh;
    color: #fff;

    /* الخلفية */
    background: url('images/admin.jpg') no-repeat center center fixed;
    background-size: cover;
  }
  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: -1;
  }

  /* الشريط الجانبي */
  .sidebar {
    width: 260px;
    background: rgba(20, 20, 20, 0.85);
    padding: 20px;
    box-shadow: 2px 0 15px rgba(255,255,255,0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    backdrop-filter: blur(5px);
  }
  .sidebar h2 {
    margin-bottom: 20px;
    text-align: center;
    color: #e91e63;
  }
  .sidebar button {
    width: 100%;
    margin: 10px 0;
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: #e91e63;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  .sidebar button:hover { background: #ff3e7f; }

  .add-store {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    margin-top: 15px;
  }
  .add-store input {
    padding: 8px;
    border-radius: 6px;
    border: none;
    background: rgba(255,255,255,0.1);
    color: #fff;
  }

  /* منطقة العرض */
  .main {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
  }
  h3 { margin-top: 0; text-align: center; color: #ff4081; }

  .stores-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  .store-card {
    background: rgba(255,255,255,0.08);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(255,255,255,0.15);
    text-align: center;
    padding-bottom: 15px;
    transition: 0.3s;
    backdrop-filter: blur(4px);
  }
  .store-card:hover { transform: scale(1.03); }
  .store-card img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-bottom: 2px solid rgba(255,255,255,0.1);
  }
  .store-card h3 { margin: 10px 0 5px 0; }
  .store-card p { margin: 3px 0; font-size: 14px; color: #ccc; }
  .store-card .actions {
    margin-top: 10px;
    display: flex;
    justify-content: center;
    gap: 10px;
  }
  .active { color: #0f0; font-weight: bold; }
  .inactive { color: #f33; font-weight: bold; }
</style>
</head>
<body>

<!-- الشريط الجانبي -->
<div class="sidebar">
  <h2>A7med_Ashraf Admin</h2>
  <button onclick="logout()">تسجيل الخروج</button>
  <div class="add-store">
    <input type="text" id="newStoreUsername" placeholder="اسم المتجر">
    <input type="password" id="newStorePassword" placeholder="كلمة المرور">
    <input type="number" id="newStoreDays" placeholder="عدد الأيام">
    <button onclick="addStore()">إضافة المتجر</button>
  </div>
</div>

<!-- منطقة عرض المتاجر -->
<div class="main">
  <h3>قائمة المتاجر</h3>
  <div class="stores-container" id="storesContainer"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC7V0kGz3p11sjF-FMSLW4kJ5WuZzNtLX0",
  authDomain: "cafe-pc-8a386.firebaseapp.com",
  databaseURL: "https://cafe-pc-8a386-default-rtdb.firebaseio.com",
  projectId: "cafe-pc-8a386",
  storageBucket: "cafe-pc-8a386.firebasestorage.app",
  messagingSenderId: "150129569328",
  appId: "1:150129569328:web:34c4980a7b9b3a6d1947f5",
  measurementId: "G-5HJ1Z58WXF"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// 🔹 تسجيل الخروج
function logout() { window.location.href = "index.html"; }

// 🔹 تحقق من باسورد الأدمن
function checkAdminPassword() {
  const pass = prompt("ادخل باسورد الأدمن للتأكيد:");
  return pass === "a7med1660"; // عدل حسب باسوردك
}

// 🔹 إضافة متجر
function addStore() {
  if (!checkAdminPassword()) return;
  const username = document.getElementById('newStoreUsername').value.trim();
  const password = document.getElementById('newStorePassword').value.trim();
  const days = parseInt(document.getElementById('newStoreDays').value);
  if (!username || !password || !days) return alert("⚠️ أدخل جميع البيانات!");

  const today = new Date();
  const endDate = new Date(today);
  endDate.setDate(today.getDate() + days);

  const storeRef = db.ref(`stores/${username}`);
  storeRef.once('value').then(snapshot => {
    if (snapshot.exists()) return alert("❌ المتجر موجود بالفعل!");
    storeRef.set({
      info: {
        password,
        joinDate: today.toISOString().split('T')[0],
        endDate: endDate.toISOString().split('T')[0],
        status: "نشط"
      }
    }).then(() => {
      alert("✅ تم إضافة المتجر بنجاح!");
      document.getElementById('newStoreUsername').value = "";
      document.getElementById('newStorePassword').value = "";
      document.getElementById('newStoreDays').value = "";
      loadStores();
    });
  });
}

// 🔹 تحميل المتاجر
function loadStores() {
  const container = document.getElementById('storesContainer');
  container.innerHTML = "<p>⏳ جاري تحميل المتاجر...</p>";
  db.ref('stores').on('value', snapshot => {
    container.innerHTML = '';
    snapshot.forEach(child => {
      const store = child.val().info;
      if (!store) return;
      const card = document.createElement('div');
      card.className = 'store-card';
      const imgPath = "images/store.jpg";
      card.innerHTML = `
        <img src="${imgPath}" alt="store">
        <h3>${child.key}</h3>
        <p>📅 البداية: ${store.joinDate || '-'}</p>
        <p>⏰ الانتهاء: ${store.endDate || '-'}</p>
        <p>🔘 الحالة: <span id="status-${child.key}" class="${store.status === 'نشط' ? 'active' : 'inactive'}">${store.status}</span></p>
        <div class="actions">
          <button onclick="toggleStatus('${child.key}')">
            ${store.status === 'نشط' ? 'إيقاف' : 'تشغيل'}
          </button>
          <button onclick="renewStore('${child.key}')">تجديد</button>
          <button onclick="deleteStore('${child.key}')">حذف</button>
        </div>
      `;
      container.appendChild(card);
    });
  });
}

// 🔹 تشغيل/إيقاف متجر
function toggleStatus(storeName) {
  if (!checkAdminPassword()) return;
  const statusRef = db.ref(`stores/${storeName}/info/status`);
  statusRef.once('value').then(snapshot => {
    const currentStatus = snapshot.val();
    const newStatus = currentStatus === "نشط" ? "متوقف" : "نشط";
    statusRef.set(newStatus).then(() => {
      alert(`✅ تم ${newStatus === 'نشط' ? 'تشغيل' : 'إيقاف'} المتجر`);
      loadStores();
    });
  });
}

// 🔹 تجديد متجر
function renewStore(storeName) {
  if (!checkAdminPassword()) return;
  const days = parseInt(prompt("أدخل عدد الأيام لتجديد الاشتراك:"));
  if (!days) return;
  const ref = db.ref(`stores/${storeName}/info`);
  ref.once('value').then(snapshot => {
    const data = snapshot.val();
    const endDate = new Date(data.endDate);
    endDate.setDate(endDate.getDate() + days);
    ref.update({ endDate: endDate.toISOString().split('T')[0], status: "نشط" });
    alert("✅ تم تجديد المتجر بنجاح!");
    loadStores();
  });
}

// 🔹 حذف متجر
function deleteStore(storeName) {
  if (!checkAdminPassword()) return;
  if (!confirm("هل أنت متأكد من حذف هذا المتجر؟")) return;
  db.ref(`stores/${storeName}`).remove().then(() => {
    alert("🗑️ تم حذف المتجر بنجاح");
    loadStores();
  });
}

// 🔹 البداية
loadStores();
</script>

</body>
</html>
