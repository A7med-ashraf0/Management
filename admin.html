<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A7med_Ashraf Admin Panel</title>
<style>
  body {
    font-family: "Tahoma", sans-serif;
    direction: rtl;
    margin: 0;
    padding: 0;
    display: flex;
    height: 100vh;
    color: #fff;

    /* Ø§Ù„Ø®Ù„ÙÙŠØ© */
    background: url('images/admin.jpg') no-repeat center center fixed;
    background-size: cover;
  }
  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: -1;
  }

  /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
  .sidebar {
    width: 260px;
    background: rgba(20, 20, 20, 0.85);
    padding: 20px;
    box-shadow: 2px 0 15px rgba(255,255,255,0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    backdrop-filter: blur(5px);
  }
  .sidebar h2 {
    margin-bottom: 20px;
    text-align: center;
    color: #e91e63;
  }
  .sidebar button {
    width: 100%;
    margin: 10px 0;
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: #e91e63;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  .sidebar button:hover { background: #ff3e7f; }

  .add-store {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    margin-top: 15px;
  }
  .add-store input {
    padding: 8px;
    border-radius: 6px;
    border: none;
    background: rgba(255,255,255,0.1);
    color: #fff;
  }

  /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¶ */
  .main {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
  }
  h3 { margin-top: 0; text-align: center; color: #ff4081; }

  .stores-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  .store-card {
    background: rgba(255,255,255,0.08);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(255,255,255,0.15);
    text-align: center;
    padding-bottom: 15px;
    transition: 0.3s;
    backdrop-filter: blur(4px);
  }
  .store-card:hover { transform: scale(1.03); }
  .store-card img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-bottom: 2px solid rgba(255,255,255,0.1);
  }
  .store-card h3 { margin: 10px 0 5px 0; }
  .store-card p { margin: 3px 0; font-size: 14px; color: #ccc; }
  .store-card .actions {
    margin-top: 10px;
    display: flex;
    justify-content: center;
    gap: 10px;
  }
  .active { color: #0f0; font-weight: bold; }
  .inactive { color: #f33; font-weight: bold; }
</style>
</head>
<body>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
<div class="sidebar">
  <h2>A7med_Ashraf Admin</h2>
  <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  <div class="add-store">
    <input type="text" id="newStoreUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±">
    <input type="password" id="newStorePassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <input type="number" id="newStoreDays" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…">
    <button onclick="addStore()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØ¬Ø±</button>
  </div>
</div>

<!-- Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ§Ø¬Ø± -->
<div class="main">
  <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø±</h3>
  <div class="stores-container" id="storesContainer"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC7V0kGz3p11sjF-FMSLW4kJ5WuZzNtLX0",
  authDomain: "cafe-pc-8a386.firebaseapp.com",
  databaseURL: "https://cafe-pc-8a386-default-rtdb.firebaseio.com",
  projectId: "cafe-pc-8a386",
  storageBucket: "cafe-pc-8a386.firebasestorage.app",
  messagingSenderId: "150129569328",
  appId: "1:150129569328:web:34c4980a7b9b3a6d1947f5",
  measurementId: "G-5HJ1Z58WXF"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ğŸ”¹ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() { window.location.href = "index.html"; }

// ğŸ”¹ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù†
function checkAdminPassword() {
  const pass = prompt("Ø§Ø¯Ø®Ù„ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ù„ØªØ£ÙƒÙŠØ¯:");
  return pass === "a7med1660"; // Ø¹Ø¯Ù„ Ø­Ø³Ø¨ Ø¨Ø§Ø³ÙˆØ±Ø¯Ùƒ
}

// ğŸ”¹ Ø¥Ø¶Ø§ÙØ© Ù…ØªØ¬Ø±
function addStore() {
  if (!checkAdminPassword()) return;
  const username = document.getElementById('newStoreUsername').value.trim();
  const password = document.getElementById('newStorePassword').value.trim();
  const days = parseInt(document.getElementById('newStoreDays').value);
  if (!username || !password || !days) return alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");

  const today = new Date();
  const endDate = new Date(today);
  endDate.setDate(today.getDate() + days);

  const storeRef = db.ref(`stores/${username}`);
  storeRef.once('value').then(snapshot => {
    if (snapshot.exists()) return alert("âŒ Ø§Ù„Ù…ØªØ¬Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„!");
    storeRef.set({
      info: {
        password,
        joinDate: today.toISOString().split('T')[0],
        endDate: endDate.toISOString().split('T')[0],
        status: "Ù†Ø´Ø·"
      }
    }).then(() => {
      alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ù†Ø¬Ø§Ø­!");
      document.getElementById('newStoreUsername').value = "";
      document.getElementById('newStorePassword').value = "";
      document.getElementById('newStoreDays').value = "";
      loadStores();
    });
  });
}

// ğŸ”¹ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¬Ø±
function loadStores() {
  const container = document.getElementById('storesContainer');
  container.innerHTML = "<p>â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¬Ø±...</p>";
  db.ref('stores').on('value', snapshot => {
    container.innerHTML = '';
    snapshot.forEach(child => {
      const store = child.val().info;
      if (!store) return;
      const card = document.createElement('div');
      card.className = 'store-card';
      const imgPath = "images/store.jpg";
      card.innerHTML = `
        <img src="${imgPath}" alt="store">
        <h3>${child.key}</h3>
        <p>ğŸ“… Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: ${store.joinDate || '-'}</p>
        <p>â° Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${store.endDate || '-'}</p>
        <p>ğŸ”˜ Ø§Ù„Ø­Ø§Ù„Ø©: <span id="status-${child.key}" class="${store.status === 'Ù†Ø´Ø·' ? 'active' : 'inactive'}">${store.status}</span></p>
        <div class="actions">
          <button onclick="toggleStatus('${child.key}')">
            ${store.status === 'Ù†Ø´Ø·' ? 'Ø¥ÙŠÙ‚Ø§Ù' : 'ØªØ´ØºÙŠÙ„'}
          </button>
          <button onclick="renewStore('${child.key}')">ØªØ¬Ø¯ÙŠØ¯</button>
          <button onclick="deleteStore('${child.key}')">Ø­Ø°Ù</button>
        </div>
      `;
      container.appendChild(card);
    });
  });
}

// ğŸ”¹ ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ù…ØªØ¬Ø±
function toggleStatus(storeName) {
  if (!checkAdminPassword()) return;
  const statusRef = db.ref(`stores/${storeName}/info/status`);
  statusRef.once('value').then(snapshot => {
    const currentStatus = snapshot.val();
    const newStatus = currentStatus === "Ù†Ø´Ø·" ? "Ù…ØªÙˆÙ‚Ù" : "Ù†Ø´Ø·";
    statusRef.set(newStatus).then(() => {
      alert(`âœ… ØªÙ… ${newStatus === 'Ù†Ø´Ø·' ? 'ØªØ´ØºÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù'} Ø§Ù„Ù…ØªØ¬Ø±`);
      loadStores();
    });
  });
}

// ğŸ”¹ ØªØ¬Ø¯ÙŠØ¯ Ù…ØªØ¬Ø±
function renewStore(storeName) {
  if (!checkAdminPassword()) return;
  const days = parseInt(prompt("Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:"));
  if (!days) return;
  const ref = db.ref(`stores/${storeName}/info`);
  ref.once('value').then(snapshot => {
    const data = snapshot.val();
    const endDate = new Date(data.endDate);
    endDate.setDate(endDate.getDate() + days);
    ref.update({ endDate: endDate.toISOString().split('T')[0], status: "Ù†Ø´Ø·" });
    alert("âœ… ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ù†Ø¬Ø§Ø­!");
    loadStores();
  });
}

// ğŸ”¹ Ø­Ø°Ù Ù…ØªØ¬Ø±
function deleteStore(storeName) {
  if (!checkAdminPassword()) return;
  if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø±ØŸ")) return;
  db.ref(`stores/${storeName}`).remove().then(() => {
    alert("ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ù†Ø¬Ø§Ø­");
    loadStores();
  });
}

// ğŸ”¹ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
loadStores();
</script>

</body>
</html>
